---
title: 'Using Complex Bayesian Hierarchical Models for "Detection" with Count Data'
author: "Ben Brintz"
institute: "IDEAS / VA"
format:
  revealjs:
    theme: white
    transition: fade
    autoAnimateDuration: 1.25
    autoAnimateEasing: linear
    auto-animate-unmatched: false
    incremental: true
    slideNumber: true
    css: custom.css
---

## Research threads at a glance {auto-animate=true}

<div style="height:1em;"></div>

<div style="
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto;
  gap: 3em;
  align-items: center;
  justify-items: center;
">

<!-- Top left -->
<div class="fragment" data-fragment-index="1" style="
  border:2px solid #333;
  border-radius:999px;
  padding:1.2em;
  background:#f5f7fa;
  text-align:center;
  font-weight:700;
  width: 80%;
">
Clinical Prediction &<br>Decision Support
</div>

<!-- Top right -->
<div class="fragment" data-fragment-index="2" style="
  border:2px solid #333;
  border-radius:999px;
  padding:1.2em;
  background:#f5f7fa;
  text-align:center;
  font-weight:700;
  width: 80%;
">
Design &<br>Analysis
</div>

<!-- Bottom center -->
<div class="fragment" data-fragment-index="3"
     style="grid-column: 1 / span 2; width: 100%; text-align: center;">
  <div data-id="bayes-core" style="
    border:2px solid #333;
    border-radius:999px;
    padding:1.4em;
    background:#f5f7fa;
    text-align:center;
    font-weight:800;
    width: 70%;
    max-width: 720px;
    margin: 0 auto;
  ">
  Complex Bayesian Hierarchical Models in Stan<br>
  
  </div>
</div>

</div>

---

##  {auto-animate=true visibility="uncounted"}

<div style="height:1.5em;"></div>

<div style="width: 100%; text-align: center;">

<div data-id="bayes-core" style="
  border:3px solid #333;
  border-radius:999px;
  padding:2em 3em;
  background:#e8f0ff;
  text-align:center;
  font-weight:900;
  font-size:1.4em;
  width: 70%;
  max-width: 720px;
  margin: 0 auto;
">
Complex Bayesian Hierarchical Models in Stan 
</div>

</div>

::: {.fragment fragment-index=2}
- Two examples of work in progress:
  - Stochastic SEIR models that incorporate imperfect **detection** - Covid-19
  - Early **detection** of call spikes - United Way 211 Calls (Food Insecurity Resources)
:::

::: {.fragment fragment-index=1}
::: {.callout-note}
S(usceptible) E(xposed) I(nfectious) R(emoved) models are a class of compartmental models used in epidemiology to simulate the spread of infectious diseases through populations.
:::
:::


---

## Case study 1: Covid-19 is not perfectly reported

- Latent disease transmission is never directly observed
- Reported cases reflect testing intensity, reporting practices, and asymptomatic disease
 - Only the sickest got diagnosed with Covid early in the pandemic 
- **Key capability:** separate what is happening from what is observed.


---

## Various approaches have been developed to estimate clinical detection rates {}

- **Back-calculation methods** estimate the number of infections from hospitalizations and deaths
- **Seroprevalence studies** estimate the proportion of the population that has been infected by testing for antibodies
- **Compartment models** estimate the number of infections from observed cases and the distribution of the incubation period
    - E.g. SIR (Susceptible-Infectious-Recovered) models
- **Key Challenge**: identifiability issues arise when trying to estimate both the true number of infections and the detection rate from observed data, especially when testing practices change over time.

---


## We propose a novel hierarchical Bayesian solution fit on observed county-level counts of new cases

- Latent SEIR compartmental process for true infections
- Estimation allows for different start time across health districts
- Transmission follows a hierarchical AR(1) process over time
- Allows an evolving recovery/incubation rate (E->I and I->R transitions) using beta-binomial transition
  - Use a novel computational solution to estimate these dynamics efficiently in Stan 

::: {.fragment}
**Modeling strategy:** allow flexibility where variability is real.
:::

---

## Estimating an evolving transmission rate using a hierarchical AR(1) process

```{r,include=T,echo=F,cache=TRUE}
library(tidyverse)
library(gganimate)

log_betas_time=readRDS("betas_time.rds")[[1]]
betas_time=readRDS("betas_time.rds")[[2]] %>% mutate(n2=as.factor(n2))
p <- ggplot() +
  geom_line(data = log_betas_time, aes(x = index, y = exp(Val)), size = 1) +
  geom_ribbon(data = log_betas_time, aes(x = index, ymin = exp(Low), ymax = exp(High)),
              alpha = 0.25, fill = "grey") +
  # Use the same transformation for y if desired (here I use exp(Val) so they align with the line)
  #geom_point(data = betas_time, aes(x = index, y = Val,group=n2,color=n2), size = 2) +
  geom_line(data = betas_time %>% filter(n2 %in% 2:5), aes(x = index, y = Val,group=n2,color=n2)) + 
  labs(x = "Week", y = "Beta (transmission)") +
  theme_bw() +
  ylim(0, 5) + theme(legend.position = "none") +
  scale_color_viridis_d(begin=.25,end=.75) +
  transition_time(time)

anim=animate(p,nframes = 200, fps = 20)
#animate(p, nframes = 100, fps = 10, renderer = gifski_renderer("density_animation.gif"))

anim
```

---

## Estimating an evolving recovery rate and incubation using beta-binomial transitions 

```{r,include=T,echo=F,cache=TRUE}
library(tidyverse)
library(gganimate)

df <- readRDS("betabin_sim.rds")
colnames(df)[2] = "Binomial Transition"
colnames(df)[3] = "Beta-Binomial Transition"
p <- df %>% 
      mutate(Week = Time) %>% select(-Time) %>%
      gather(Approach, Infections,-Week) %>%
      ggplot(aes(x=Week,y=Infections,group=Approach,color=Approach)) +
        geom_point() + geom_line() +
        labs(x = "Week", y = "Infections") +
        theme_bw() + scale_color_viridis_d(begin=.25,end=.75) +
        theme(legend.position = "bottom") +
        transition_reveal(Week)

anim <- animate(p, nframes = 100, fps = 5)

anim
```

---

##

![](utah_p_dens_020325.png){height=500px}

---

##

![](utah_120525_bb.png){height=500px}

---

## Case study 2: Can spikes in 211 calls be detected early? 

- 211 is a nationwide, free public referral system that responds to >20 million requests for help each year from U.S. residents
- Call counts follow a zero-inflated negative binomial process
- Explicitly separates true zero-demand days from low-volume noise
- Overdispersion captures variability beyond simple Poisson assumptions

::: {.fragment}
**Modeling choice:** distribution matches real call behavior rather than forcing Gaussian assumptions.
:::

---

## Hierarchical modeling for early warning

- Latent call intensity evolves smoothly via an AR(1) process
- Seasonal patterns captured with Fourier components
- AR(1) structure and regularized effects stabilize estimates across time

::: {.fragment}
**Capability:** detects change against strong seasonal and weekly structure.
:::

---

## Detecting anomalies without hard thresholds

- Smooth change-points modeled as logistic ramps
- A horseshoe prior learns how many structural changes are needed
- A random shock component captures short-lived anomalies

::: {.fragment}
**Why this works:** the model adapts complexity to the data instead of fixing it in advance.
:::

---

## What unifies this work

- Latent-process Bayesian models with temporal dependence
- Flexible distributions matched to real-world data
- Early detection through probabilistic change modeling

---

## Current focus areas

- Early detection under delayed, zero-inflated, and overdispersed data
- Adaptive hierarchical models for evolving systems
- Decision-focused uncertainty rather than point predictions

---

## Looking ahead

- Integrating causal reasoning with hierarchical prediction
- Adaptive monitoring for rapid response
- Decision support that anticipates equity impacts

---

## Thank you

Questions or collaborations welcome.
